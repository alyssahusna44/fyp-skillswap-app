-- Create the email validation function
CREATE OR REPLACE FUNCTION validate_unikl_email(email_input text)
RETURNS boolean AS $$
BEGIN
  RETURN position('@s.unikl.edu.my' in email_input) > 0;
END;
$$ LANGUAGE plpgsql;

-- Add trigger to profiles table instead
CREATE OR REPLACE FUNCTION check_profile_email()
RETURNS TRIGGER AS $$
BEGIN
  IF NOT validate_unikl_email(NEW.email) THEN
    RAISE EXCEPTION 'Only emails with @s.unikl.edu.my domain are allowed.';
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger on profiles table
CREATE TRIGGER check_profile_email_trigger
  BEFORE INSERT OR UPDATE ON profiles
  FOR EACH ROW
  EXECUTE FUNCTION check_profile_email();
